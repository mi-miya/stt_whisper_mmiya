# ローカル Whisper 音声入力システム (Windows用)

パソコンの中で動く「音声入力ツール」です。
ネットに繋がなくても、ショートカットキーやボタンひとつで声を文字にして、クリップボードにコピーしてくれます。

## 特徴
- **どこでも入力**: メモ帳、ブラウザ、Word、どこでも使えます
- **クリップボード経由**: `Ctrl+V` でどこにでも貼り付け可能
- **超軽量・常駐OK**: 待機中はパソコンのパワーをほとんど使いません
- **高速・高精度**: OpenAI Whisper を使ってローカル（自分のPC内）で変換します
- **安心プライバシー**: 音声データはネットに送信されません
- **かんたん操作**: マイクボタンをクリック、またはキーを押すだけ
- **効果音付き**: 画面を見なくても音でわかります
- **録音キャンセル**: いつでも `Esc` キーで録音を中止できます
- **設定GUI搭載**: 右クリックメニューから簡単に設定変更できます
- **セットアップウィザード**: 初回起動時にガイドに従って設定できます

---

## セットアップ手順（初回のみ）

### ステップ1: Python の確認

1. キーボードの **`Win` + `R`** を押します
2. 「`cmd`」と入力して `Enter` を押します
3. 黒い画面が開いたら、次のように入力して `Enter` を押します:
   ```
   python --version
   ```
4. 「Python 3.x.x」のように表示されたら成功です

**エラーが出た場合:**
- [Python公式サイト](https://www.python.org/downloads/) からインストールしてください
- インストール時に **"Add Python to PATH"** にチェックを入れてください

---

### ステップ2: Whisper 本体のダウンロード

1. [whisper.cpp のリリースページ](https://github.com/ggml-org/whisper.cpp/releases) を開きます
2. 以下のファイルをダウンロードします:
   - **CPU版**: `whisper-bin-x64.zip`
   - **GPU版（NVIDIA）**: `whisper-cublas-*-bin-x64.zip`

3. 解凍して、**`whisper-cli.exe`**（または `main.exe` をリネーム）と **`*.dll`** ファイルを **`bin`** フォルダにコピーします

---

### ステップ3: 必要なプログラムのインストール

**`install.bat`** をダブルクリックします。「Installation complete!」と表示されたら完了です。

---

### ステップ4: 起動とセットアップウィザード

**`launch.vbs`** をダブルクリックして起動します。

**初回起動時は「セットアップウィザード」が自動的に表示されます:**
1. Whisper CLI の確認
2. モデルのダウンロード（アプリ内から直接ダウンロード可能）
3. 言語・GPU設定
4. 完了

---

## 使い方

### 起動

**`launch.vbs`** をダブルクリック → 画面左上に緑色のマイクアイコンが表示されれば起動成功

### 音声入力

**方法1: マイクアイコンをクリック**
1. 緑のマイクアイコンをクリック → 赤色に変わったら喋る
2. もう一度クリック → 文字がクリップボードに保存

**方法2: ホットキー**
- **`Ctrl` + `Alt` + `Shift` + `J`**（初期設定）を押す
- 話し終わったらもう一度同じキーを押す

**録音キャンセル:** 録音中に **`Esc`** キーを押す

### 貼り付け

**`Ctrl` + `V`** で貼り付け（自動貼り付け機能も設定可能）

### 終了

マイクアイコンを**右クリック** → **「終了」**

---

## 設定の変更

### 設定画面を開く

マイクアイコンを**右クリック** → **「設定」**

### 主な設定項目

| タブ | 設定項目 | 説明 |
|------|----------|------|
| **基本** | モデル | 使用する音声認識モデル |
| | 言語 | 認識言語（日本語/英語など） |
| | 自動貼り付け | 変換後に自動で貼り付け |
| | 効果音 | 録音開始/終了時の効果音 |
| **詳細** | GPU使用 | GPUレイヤー数（NVIDIA GPU用） |
| | サンプルレート | 録音品質 |
| | 無音判定の閾値 | 無音検出の感度 |
| **認識精度** | 初期プロンプト | 認識精度向上のヒント |
| | 候補数/ビームサイズ | 詳細な認識パラメータ |
| **ホットキー** | ショートカットキー | 録音開始/停止のキー |

設定後、「保存して再起動」をクリックすると反映されます。

---

## GPUで高速化する方法

NVIDIA GPU（GeForceなど）をお持ちの場合:

1. [リリースページ](https://github.com/ggml-org/whisper.cpp/releases) から `whisper-cublas-*-bin-x64.zip` をダウンロード
2. 解凍して `bin` フォルダに上書きコピー
3. 設定 → 詳細 → GPU使用を `60` または `99` に変更
4. 「保存して再起動」

---

## トラブルシューティング

### 起動しない

**`debug.bat`** をダブルクリックしてエラーメッセージを確認

**よくあるエラー:**
- 「python が見つかりません」→ Python をインストール
- 「ModuleNotFoundError」→ `install.bat` を再実行
- 「whisper-cli.exe が見つかりません」→ `bin` フォルダを確認

### 文字起こしされない

- `bin/whisper-cli.exe` があるか確認
- `models/*.bin` があるか確認
- マイクが接続されているか確認

### 品質が悪い

- 設定 → 認識精度 → 初期プロンプトを短くするか空にする
- より高精度なモデル（`ggml-large-v3-turbo.bin`）を使用

### 速度が遅い

- GPU版を使用する
- 軽量モデル（`ggml-small.bin`）を使用
- 候補数/ビームサイズを小さくする

---

## フォルダ構成

```
stt_whisper/
├── app/                 # アプリケーションコード
├── bin/
│   ├── whisper-cli.exe
│   └── *.dll
├── models/
│   └── ggml-*.bin
├── sounds/              # 効果音
├── logs/                # ログファイル
├── build/               # ポータブル版作成用
├── config.json          # 設定ファイル（自動生成）
├── config.default.json  # デフォルト設定
├── install.bat
├── launch.vbs
├── debug.bat
└── README.md
```

---

## ポータブル版の作成

Python がインストールされていない環境用のパッケージを作成:

```
python build/create_portable.py
```

`dist/stt_whisper_portable/` に配布用パッケージが作成されます。

---

快適な音声入力ライフをお楽しみください！
